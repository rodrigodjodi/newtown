<krpano debugmode="true" strict="true">
  <events name="sibebar_events" keep="true"
    onresize="sidebar-adjust"
  />
  <action name="sidebar-adjust">
  
    if(stageheight LT 480,
      set(layer[logo].crop, 0|0|320|64);
      set(layer[map].y, 64);
    ,
      set(layer[logo].crop, 0|64|320|200 );
      set(layer[map].y, 200);
    );
  </action>  

  <layer name="menu" 
    type="image"
    url="map-sprite.png"
    crop="144|0|48|48"
    onclick="sidebar_open"
    keep="true"
    visible="true"
    x="8"
    y="8"
    zorder="10"
  />
  <action name="sidebar_open">
    set(layer[menu].visible, false);
    set(layer[skin_layer].visible, false);
    set(layer[sidebar].visible, true);
    tween(layer[sidebar].x, 0, 0.3, default);
  </action>

  <layer name="sidebar"
    type="container"
    height="100%"
    width="320"
    keep="true"
    bgcolor="0x333333"
    bgalpha="0.5"
    x="-320"
    zorder="2"
    visible="false"
    bgshadow="6 0 5 black 0.4"
     
  />
  <layer name="logo"
     type="image"
     url="drawer.png"
     crop="0|64|320|200"
     keep="true"
     visible="true"
     parent="sidebar"
     handcursor="false"
     
   
  />
  <layer name="close"
     type="image"
     url="map-sprite.png"
    crop="192|0|48|48" 
     keep="true"
     visible="true"
     parent="sidebar"
     x="8"
     y="8"
     onclick="sidebar_close"
     zorder="15"
  />

 <action name="sidebar_close">
  set(layer[skin_layer].visible, true);
  tween(layer[sidebar].x, -320, 0.3, default,
    set(layer[menu].visible, true);
    set(layer[sidebar].visible, false);
  );
 </action>

  <layer name="map"
    url="drawer.png"
    crop="0|264|320|296"
    keep="true"
    handcursor="false"
    capture="false"
    align="lefttop"
    x="0"
    y="200"
    scale="1"
    scalechildren="true"
	maskchildren="true"
    visible="true"
    parent="sidebar"
    zorder="3"
  />
  <style name="mapspot"
    scale="1"
    url="map-sprite.png"
    crop="48|0|48|48"
    parent="map"
    align="lefttop"
    edge="center"
    alpha="1"
    zorder="7"
    onclick="mapspot_loadscene(get(linkedscene));"
  />
  <style name="mapspot-visited"
    keep="true"
    scale="1"
    url="map-sprite.png"
    crop="0|0|48|48"
    parent="map"
    align="lefttop"
    edge="center"
    alpha="1"
    zorder="7"
    onclick="mapspot_loadscene(get(linkedscene));"
  />

  <action name="mapspot_loadscene">
      loadscene(%1, null, MERGE, BLEND(1));
  </action>

  <layer name="activespot"
    scale="1"
    url="map-sprite.png"
    crop="96|0|48|48"
    keep="true"
    alpha="1"
    align="lefttop"
    zorder="10" 
    visible="false"
  />      

  <plugin name="radar" keep="true"
    url.html5="%HTMLPATH%/plugins/radar.js"
    align="lefttop" zorder="1" edge="center"
    fillalpha="0.5" fillcolor="0xFF5F3F"
    linewidth="1.0" linecolor="0xE0E0A0" linealpha="0.5"
    editmode="false" enabled="true" parent="map"
           
	/>  
  <!-- não funciona máscara em html5       
  <plugin name="mapmask" url="estar.png" keep="true" parent="map" enabled="false"
  />--> 

  <action name="on_scene_loaded"> <!--toDO: fazer por aqui o setup de cena, tirando comandos krpano do script do html-->
    def(spotname, string, calc('spot-'+'%1'));
    if(layer[get(spotname)],
      layer[get(spotname)].loadstyle(mapspot-visited);
      copy(plugin[radar].x, layer[get(spotname)].x);
      copy(plugin[radar].y, layer[get(spotname)].y);
      set(layer[activespot].parent, get(spotname));
    ,
    trace(calc('mapspot não encontrado: '+ spotname))
    );
	  set(plugin[radar].heading, %2);
  </action>


</krpano>


